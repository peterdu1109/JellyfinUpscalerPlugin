<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <title>Plugin de Sur√©chantillonnage IA 1.6</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: transparent;
            color: inherit;
        }

        .pluginConfigurationPage {
            max-width: 1000px;
            margin: 0 auto;
        }

        .config-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(0, 164, 220, 0.1), rgba(0, 164, 220, 0.05));
            border-radius: 12px;
            border: 2px solid rgba(0, 164, 220, 0.3);
        }

        .config-header h1 {
            color: #00a4dc;
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 700;
        }

        .config-header .subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1em;
            margin: 0;
        }

        .config-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .config-section h2 {
            color: #00a4dc;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.6em;
            font-weight: 600;
            border-bottom: 3px solid rgba(0, 164, 220, 0.4);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #00a4dc;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(0, 164, 220, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #00a4dc;
            box-shadow: 0 0 0 3px rgba(0, 164, 220, 0.2);
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .checkbox-group label {
            margin-bottom: 0;
            margin-left: 10px;
            font-weight: 500;
        }

        .description {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
            font-style: italic;
        }

        .button-group {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
        }

        .btn {
            padding: 12px 25px;
            margin: 0 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00a4dc, #0080b3);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0080b3, #006699);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 164, 220, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #545b62, #424649);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
        }

        .success-message {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .info-card {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
            border: 2px solid rgba(40, 167, 69, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .info-card h3 {
            color: #28a745;
            margin: 0 0 10px 0;
            font-size: 1.3em;
            font-weight: 600;
        }

        .info-card p {
            margin: 0;
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.9);
        }

        .grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2col {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="pluginConfigurationPage">
        <div class="config-header">
            <h1>üéÆ Plugin de Sur√©chantillonnage IA</h1>
            <p class="subtitle">Version 1.6.0 - Am√©lioration Vid√©o IA Ultime</p>
        </div>

        <div class="info-card">
            <h3>üöÄ Plugin Install√© avec Succ√®s !</h3>
            <p>Le Plugin de Sur√©chantillonnage IA est maintenant actif et pr√™t √† am√©liorer vos vid√©os. Configurez vos
                param√®tres ci-dessous et cherchez le bouton "üéÆ IA" dans votre lecteur vid√©o.</p>
        </div>

        <form id="configForm">
            <div class="config-section">
                <h2>‚öôÔ∏è Param√®tres de Base</h2>

                <div class="checkbox-group">
                    <input type="checkbox" id="EnablePlugin" checked>
                    <label for="EnablePlugin">Activer le Plugin de Sur√©chantillonnage IA</label>
                </div>
                <div class="description">Interrupteur principal pour activer ou d√©sactiver le plugin</div>

                <div class="checkbox-group">
                    <input type="checkbox" id="ShowPlayerButton" checked>
                    <label for="ShowPlayerButton">Afficher le Bouton IA dans le Lecteur Vid√©o</label>
                </div>
                <div class="description">Ajoute le bouton de sur√©chantillonnage IA aux contr√¥les du lecteur vid√©o</div>

                <div class="form-group">
                    <label for="Model">Mod√®le IA par D√©faut :</label>
                    <select id="Model">
                        <option value="realesrgan" selected>Real-ESRGAN (Meilleure Qualit√© Globale)</option>
                        <option value="esrgan-pro">ESRGAN Pro (Films & S√©ries TV)</option>
                        <option value="swinir">SwinIR (Sc√®nes Complexes)</option>
                        <option value="srcnn-light">SRCNN Light (Traitement Rapide)</option>
                        <option value="waifu2x">Waifu2x (Contenu Anime)</option>
                        <option value="hat">HAT (Am√©lioration Haute D√©tail)</option>
                        <option value="edsr">EDSR (Sur√©chantillonnage Pr√©cis)</option>
                        <option value="vdsr">VDSR (Apprentissage Profond)</option>
                        <option value="rdn">RDN (Am√©lioration Texture)</option>
                        <option value="srresnet">SRResNet (Performance √âquilibr√©e)</option>
                        <option value="carn">CARN (Compact & Rapide)</option>
                        <option value="rrdbnet">RRDBNet (Haute Qualit√©)</option>
                        <option value="drln">DRLN (R√©duction de Bruit)</option>
                        <option value="fsrcnn">FSRCNN (L√©ger)</option>
                    </select>
                    <div class="description">S√©lectionnez le mod√®le IA principal pour le sur√©chantillonnage vid√©o</div>
                </div>

                <div class="grid-2col">
                    <div class="form-group">
                        <label for="ScaleFactor">Facteur d'√âchelle :</label>
                        <select id="ScaleFactor">
                            <option value="2">Sur√©chantillonnage 2x</option>
                            <option value="3" selected>Sur√©chantillonnage 3x</option>
                            <option value="4">Sur√©chantillonnage 4x</option>
                        </select>
                        <div class="description">Facteur de sur√©chantillonnage par d√©faut</div>
                    </div>

                    <div class="form-group">
                        <label for="QualityLevel">Niveau de Qualit√© :</label>
                        <select id="QualityLevel">
                            <option value="high">Haute Qualit√© (Meilleurs R√©sultats)</option>
                            <option value="medium" selected>Qualit√© Moyenne (√âquilibr√©)</option>
                            <option value="low">Basse Qualit√© (Le Plus Rapide)</option>
                        </select>
                        <div class="description">√âquilibre entre qualit√© et vitesse</div>
                    </div>
                </div>
            </div>

            <div class="config-section">
                <h2>üîß Param√®tres Mat√©riels</h2>

                <div class="checkbox-group">
                    <input type="checkbox" id="EnableHardwareAcceleration" checked>
                    <label for="EnableHardwareAcceleration">Activer l'Acc√©l√©ration Mat√©rielle</label>
                </div>
                <div class="description">Utiliser le GPU pour un traitement plus rapide si disponible</div>

                <div class="grid-2col">
                    <div class="form-group">
                        <label for="MaxVRAMUsage">Utilisation VRAM Max (Mo) :</label>
                        <input type="number" id="MaxVRAMUsage" value="2048" min="512" max="16384">
                        <div class="description">VRAM maximale √† utiliser pour le sur√©chantillonnage</div>
                    </div>

                    <div class="form-group">
                        <label for="CpuThreads">Threads CPU :</label>
                        <input type="number" id="CpuThreads" value="4" min="1" max="32">
                        <div class="description">Nombre de threads CPU pour le traitement</div>
                    </div>
                </div>
            </div>

            <div class="config-section">
                <h2>üéÆ Int√©gration Lecteur Vid√©o</h2>

                <div class="checkbox-group">
                    <input type="checkbox" id="EnableNotifications" checked>
                    <label for="EnableNotifications">Activer les Notifications de Progression</label>
                </div>
                <div class="description">Afficher les notifications de progression du sur√©chantillonnage</div>

                <div class="checkbox-group">
                    <input type="checkbox" id="AutoRetryButton" checked>
                    <label for="AutoRetryButton">Injection Bouton Auto-R√©essai</label>
                </div>
                <div class="description">R√©essayer automatiquement si le bouton IA n'appara√Æt pas</div>

                <div class="form-group">
                    <label for="ButtonPosition">Position du Bouton :</label>
                    <select id="ButtonPosition">
                        <option value="right" selected>C√¥t√© Droit</option>
                        <option value="left">C√¥t√© Gauche</option>
                        <option value="center">Centre</option>
                    </select>
                    <div class="description">Position du bouton IA dans le lecteur vid√©o</div>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-primary" onclick="saveConfiguration()">
                    üíæ Enregistrer la Configuration
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetConfiguration()">
                    üîÑ R√©initialiser par D√©faut
                </button>
            </div>
        </form>
    </div>

    <script type="text/javascript">
        (function () {
            'use strict';

            // Configuration object with defaults
            var config = {
                EnablePlugin: true,
                ShowPlayerButton: true,
                Model: 'realesrgan',
                ScaleFactor: 3,
                QualityLevel: 'medium',
                EnableHardwareAcceleration: true,
                MaxVRAMUsage: 2048,
                CpuThreads: 4,
                EnableNotifications: true,
                AutoRetryButton: true,
                ButtonPosition: 'right'
            };

            // Plugin ID for API calls
            var pluginId = 'f87f700e-679d-43e6-9c7c-b3a410dc3f22';

            // Initialize the configuration page
            function init() {
                console.log('Plugin Sur√©chantillonnage IA : Initialisation page configuration...');
                loadConfiguration();
                updateUI();
                console.log('Plugin Sur√©chantillonnage IA : Page configuration charg√©e avec succ√®s');
            }

            // Load configuration from Jellyfin
            function loadConfiguration() {
                try {
                    // Try to load from Jellyfin API first
                    if (typeof ApiClient !== 'undefined' && ApiClient.getPluginConfiguration) {
                        ApiClient.getPluginConfiguration(pluginId).then(function (currentConfig) {
                            if (currentConfig) {
                                config = Object.assign(config, currentConfig);
                                updateUI();
                                console.log('Sur√©chantillonnage IA : Configuration charg√©e depuis API Jellyfin');
                            }
                        }).catch(function (error) {
                            console.log('Sur√©chantillonnage IA : Repli vers localStorage -', error);
                            loadFromLocalStorage();
                        });
                    } else {
                        loadFromLocalStorage();
                    }
                } catch (error) {
                    console.log('Sur√©chantillonnage IA : Erreur chargement configuration -', error);
                    loadFromLocalStorage();
                }
            }

            // Load from localStorage as fallback
            function loadFromLocalStorage() {
                try {
                    var stored = localStorage.getItem('aiUpscalerConfig');
                    if (stored) {
                        config = Object.assign(config, JSON.parse(stored));
                        updateUI();
                        console.log('Sur√©chantillonnage IA : Configuration charg√©e depuis localStorage');
                    }
                } catch (error) {
                    console.log('Sur√©chantillonnage IA : Utilisation configuration par d√©faut');
                }
            }

            // Update UI with current configuration
            function updateUI() {
                Object.keys(config).forEach(function (key) {
                    var element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = !!config[key];
                        } else if (element.type === 'number') {
                            element.value = config[key] || 0;
                        } else {
                            element.value = config[key] || '';
                        }
                    }
                });
            }

            // Save configuration
            window.saveConfiguration = function () {
                try {
                    // Collect all form values
                    Object.keys(config).forEach(function (key) {
                        var element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                config[key] = element.checked;
                            } else if (element.type === 'number') {
                                config[key] = parseInt(element.value) || 0;
                            } else {
                                config[key] = element.value;
                            }
                        }
                    });

                    // Save to Jellyfin API
                    if (typeof ApiClient !== 'undefined' && ApiClient.updatePluginConfiguration) {
                        ApiClient.updatePluginConfiguration(pluginId, config).then(function () {
                            showSuccessMessage('‚úÖ Configuration enregistr√©e avec succ√®s !');
                            injectPlayerButton();
                        }).catch(function (error) {
                            console.error('Sur√©chantillonnage IA : √âchec sauvegarde API -', error);
                            fallbackSave();
                        });
                    } else {
                        fallbackSave();
                    }
                } catch (error) {
                    console.error('Sur√©chantillonnage IA : Erreur sauvegarde -', error);
                    fallbackSave();
                }
            };

            // Fallback save method
            function fallbackSave() {
                try {
                    localStorage.setItem('aiUpscalerConfig', JSON.stringify(config));
                    showSuccessMessage('‚úÖ Configuration enregistr√©e (mode repli)');
                    injectPlayerButton();
                } catch (error) {
                    showErrorMessage('‚ùå √âchec sauvegarde : ' + error.message);
                }
            }

            // Reset to defaults
            window.resetConfiguration = function () {
                if (confirm('R√©initialiser tous les param√®tres par d√©faut ?')) {
                    config = {
                        EnablePlugin: true,
                        ShowPlayerButton: true,
                        Model: 'realesrgan',
                        ScaleFactor: 3,
                        QualityLevel: 'medium',
                        EnableHardwareAcceleration: true,
                        MaxVRAMUsage: 2048,
                        CpuThreads: 4,
                        EnableNotifications: true,
                        AutoRetryButton: true,
                        ButtonPosition: 'right'
                    };

                    updateUI();
                    showSuccessMessage('‚úÖ Param√®tres r√©initialis√©s par d√©faut');
                }
            };

            // Inject player button after save
            function injectPlayerButton() {
                if (!config.ShowPlayerButton) return;

                // Create and inject the player integration script
                var script = document.createElement('script');
                script.src = 'web/player-integration.js';
                script.onload = function () {
                    console.log('Sur√©chantillonnage IA : Script int√©gration lecteur charg√©');
                };
                document.head.appendChild(script);
            }

            // Show success message
            function showSuccessMessage(message) {
                removeExistingMessage();

                var messageDiv = document.createElement('div');
                messageDiv.className = 'success-message';
                messageDiv.textContent = message;
                messageDiv.id = 'configMessage';

                var container = document.querySelector('.pluginConfigurationPage');
                container.insertBefore(messageDiv, container.firstChild);

                setTimeout(function () {
                    removeExistingMessage();
                }, 3000);
            }

            // Show error message
            function showErrorMessage(message) {
                removeExistingMessage();

                var messageDiv = document.createElement('div');
                messageDiv.style.cssText = 'background: #dc3545; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: 600;';
                messageDiv.textContent = message;
                messageDiv.id = 'configMessage';

                var container = document.querySelector('.pluginConfigurationPage');
                container.insertBefore(messageDiv, container.firstChild);

                setTimeout(function () {
                    removeExistingMessage();
                }, 5000);
            }

            // Remove existing message
            function removeExistingMessage() {
                var existing = document.getElementById('configMessage');
                if (existing) {
                    existing.remove();
                }
            }

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }

            // Load Quick Menu and Player Integration
            function loadJavaScriptComponents() {
                try {
                    // Load Quick Menu
                    fetch('/web/ConfigurationPage?name=aiupscaler-quickmenu.js')
                        .then(response => response.text())
                        .then(script => {
                            const scriptElement = document.createElement('script');
                            scriptElement.textContent = script;
                            document.head.appendChild(scriptElement);
                            console.log('Sur√©chantillonnage IA : Menu Rapide charg√©');
                        })
                        .catch(error => console.log('Erreur chargement Menu Rapide:', error));

                    // Load Player Integration  
                    fetch('/web/ConfigurationPage?name=aiupscaler-player.js')
                        .then(response => response.text())
                        .then(script => {
                            const scriptElement = document.createElement('script');
                            scriptElement.textContent = script;
                            document.head.appendChild(scriptElement);
                            console.log('Sur√©chantillonnage IA : Int√©gration Lecteur charg√©e');
                        })
                        .catch(error => console.log('Erreur chargement Int√©gration Lecteur:', error));
                } catch (error) {
                    console.log('Erreur chargement composants JavaScript:', error);
                }
            }

            // Load components after page init
            setTimeout(loadJavaScriptComponents, 1000);
        })();
    </script>
</body>

</html>